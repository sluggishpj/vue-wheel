language: node_js
node_js: stable
sudo: required

# 构建的分支
branches:
  only: 
    -master

before_install:
  # 参考：https://yarnpkg.com/lang/en/docs/install-ci/
  # Repo for Yarn
  - sudo apt-key adv --fetch-keys http://dl.yarnpkg.com/debian/pubkey.gpg
  - echo "deb http://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
  - sudo apt-get update -qq
  - sudo apt-get install -y -qq yarn


# S: Build Lifecycle
install: 
  -yarn install

script:
  - yarn run build

after_script:
  - cd ./dist
  - git init
  - git config user.name "sluggishpj"
  - git config user.email "sluggishpj@qq.com"
  - git add .
  - git commit -m "Update"
  - git push --force --quiet "https://${GITHUB_TOKEN}@${GH_REF}" master:master

env:
  global:
    - GH_REF: github.com/sluggishpj/vue-wheel.git

cache:
  yarn: true